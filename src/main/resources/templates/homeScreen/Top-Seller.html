<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Top Sellers Banner</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body th:fragment="hotproduct" class="min-h-screen bg-white p-6">
<div class="mx-auto max-w-6xl">
    <!-- Top Sellers Banner -->
    <section
            id="top-sellers"
            class="relative mb-8 overflow-hidden rounded-2xl border-2 border-gray-400 bg-white shadow-sm"
            data-rotate-interval="5000"
            th:attr="data-max-items=${#lists.size(product5)}"
            aria-label="Top seller products"
            aria-roledescription="carousel"
            aria-live="polite"
    >
        <!-- Slides -->
        <div class="relative h-[22rem]">
            <!-- Loop through each product to create a slide -->
            <div th:each="product, iterStat : ${product5}"
                 class="ts-slide absolute inset-0 grid grid-cols-1 items-center gap-6 p-6 transition-opacity duration-700 md:grid-cols-2 md:p-10"
                 th:classappend="${iterStat.index == 0} ? 'opacity-100' : 'opacity-0'"
                 th:data-index="${iterStat.index}"
                 th:aria-hidden="${iterStat.index != 0}">

                <!-- Product Info -->
                <div class="space-y-3">
                    <span class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-700">
                        Top Seller
                    </span>
                    <h2 class="text-2xl font-semibold text-gray-900" th:text="${product.name}">
                        Wireless Headphones
                    </h2>
                    <p class="text-gray-600" th:text="${product.description}">
                        Noise-cancelling, 30h battery, and ultra-soft cushions for all-day comfort.
                    </p>
                    <div class="flex items-center gap-3">
                        <span class="text-lg font-semibold text-gray-900"
                              th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">
                            $89.00
                        </span>
                    </div>
                </div>

                <!-- Product Image -->
                <div class="relative h-60 w-full overflow-hidden rounded-xl md:h-72">
                    <img
                            th:src="${product.imageUrl}"
                            th:alt="${product.name}"
                            class="h-full w-full object-cover"
                            loading="lazy"
                    />
                </div>
            </div>
        </div>

        <!-- Dots -->
        <div class="pointer-events-none absolute bottom-3 left-0 right-0 flex justify-center gap-2 md:bottom-4">
            <span th:each="product, iterStat : ${product5}"
                  class="ts-dot h-2 w-2 rounded-full"
                  th:classappend="${iterStat.index == 0} ? 'bg-indigo-600' : 'bg-gray-300'">
            </span>
        </div>
    </section>
</div>


<script>
    // Minimal auto-rotate (5s) with optional max items limit (data-max-items)
    (function () {
        const root = document.getElementById('top-sellers');
        if (!root) return;

        const slides = Array.from(root.querySelectorAll('.ts-slide'));
        let dots      = Array.from(root.querySelectorAll('.ts-dot'));

        const interval = parseInt(root.dataset.rotateInterval || '3000', 10);
        const maxAttr  = parseInt(root.dataset.maxItems || slides.length, 10);
        const MAX      = Math.max(1, Math.min(maxAttr, slides.length));

        // If more slides/dots than MAX, trim extra dots to keep indicators accurate
        if (dots.length > MAX) {
            dots.slice(MAX).forEach(d => d.remove());
            dots = Array.from(root.querySelectorAll('.ts-dot'));
        }

        let i = 0;
        function show(idx) {
            slides.forEach((el, n) => {
                const active = n === idx;
                el.style.zIndex = active ? 1 : 0;
                el.classList.toggle('opacity-100', active);
                el.classList.toggle('opacity-0', !active);
                el.setAttribute('aria-hidden', active ? 'false' : 'true');
            });
            dots.forEach((dot, n) => {
                const active = n === idx;
                dot.classList.toggle('bg-indigo-600', active);
                dot.classList.toggle('bg-gray-300', !active);
                dot.classList.toggle('dark:bg-gray-600', !active);
            });
        }

        show(i);

        // Respect reduced motion and pause when tab hidden
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (prefersReduced) return;

        let timer = setInterval(next, interval);
        function next() {
            i = (i + 1) % MAX;
            show(i);
        }

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                clearInterval(timer);
            } else {
                timer = setInterval(next, interval);
            }
        });
    })();
</script>
</body>
</html>
