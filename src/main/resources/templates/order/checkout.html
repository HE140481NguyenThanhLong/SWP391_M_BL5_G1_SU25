<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

<div th:replace="~{component/header :: header}" ></div>

<section class="bg-white py-8 antialiased md:py-16">
    <form th:action="@{/checkout/create}" method="post" class="mx-auto max-w-screen-xl px-4 2xl:px-0">
        <ol class="items-center flex w-full max-w-2xl text-center text-sm font-medium text-gray-500 sm:text-base">
            <li class="after:border-1 flex items-center text-primary-700 after:mx-6 after:hidden after:h-1 after:w-full after:border-b after:border-gray-200 sm:after:inline-block sm:after:content-[''] md:w-full xl:after:mx-10">
                <span class="flex items-center after:mx-2 after:text-gray-200 after:content-['/'] sm:after:hidden">
                    <svg class="me-2 h-4 w-4 sm:h-5 sm:w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.5 11.5 11 14l4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    Cart
                </span>
            </li>

            <li class="after:border-1 flex items-center text-primary-700 after:mx-6 after:hidden after:h-1 after:w-full after:border-b after:border-gray-200 sm:after:inline-block sm:after:content-[''] md:w-full xl:after:mx-10">
                <span class="flex items-center after:mx-2 after:text-gray-200 after:content-['/'] sm:after:hidden">
                    <svg class="me-2 h-4 w-4 sm:h-5 sm:w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.5 11.5 11 14l4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    Checkout
                </span>
            </li>

            <li class="flex shrink-0 items-center">
                <svg class="me-2 h-4 w-4 sm:h-5 sm:w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.5 11.5 11 14l4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                Chi tiết đơn hàng
            </li>
        </ol>

        <div class="mt-6 sm:mt-8 lg:flex lg:items-start lg:gap-12 xl:gap-16">
            <div class="min-w-0 flex-1 space-y-8">
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-900">Thông tin giao hàng</h2>
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                        <div>
                            <label for="name" class="mb-2 block text-sm font-medium text-gray-900">Tên người nhận</label>
                            <input type="text" name="name" id="name" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500" placeholder="Bonnie Green" required />
                        </div>

                        <div>
                            <label for="your_email" class="mb-2 block text-sm font-medium text-gray-900">Email*</label>
                            <input type="email" name="email" id="your_email" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500" placeholder="name@flowbite.com" required />
                        </div>

                        <div>
                            <div class="mb-2 flex items-center gap-2">
                                <label for="country" class="block text-sm font-medium text-gray-900">Quốc gia*</label>
                            </div>
                            <select name="country" id="country" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500">
                                <option selected>Việt Nam</option>
                            </select>
                        </div>

                        <div>
                            <div class="mb-2 flex items-center gap-2">
                                <label for="phone" class="block text-sm font-medium text-gray-900">Số điện thoại*</label>
                            </div>
                            <input type="text" name="phone" id="phone" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500" placeholder="0123456789" required />
                        </div>

                        <div>
                            <div class="mb-2 flex items-center gap-2">
                                <label for="province" class="block text-sm font-medium text-gray-900">Tỉnh/Thành phố*</label>
                            </div>
                            <select id="province" name="province" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500"></select>
                        </div>

                        <div>
                            <div class="mb-2 flex items-center gap-2">
                                <label for="ward" class="block text-sm font-medium text-gray-900">Xã/Phường*</label>
                            </div>
                            <select id="ward" name="ward" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500"></select>
                        </div>
                        <script>
                            async function loadProvinces() {
                                const res = await fetch("http://localhost:8080/api/address/provinces");
                                const provinces = await res.json();
                                const select = document.getElementById("province");
                                select.innerHTML = '<option value="">--Chọn Tỉnh/Thành phố--</option>';
                                provinces.forEach(p => {
                                    select.innerHTML += `<option value="${p.province_code}">${p.name}</option>`;
                                });
                            }

                            async function loadWards(provinceCode) {
                                if (!provinceCode) {
                                    document.getElementById("ward").innerHTML = '<option value="">--Chọn Xã/Phường--</option>';
                                    return;
                                }
                                const res = await fetch(`http://localhost:8080/api/address/wards/${provinceCode}`);
                                const wards = await res.json();
                                const select = document.getElementById("ward");
                                select.innerHTML = '<option value="">--Chọn Xã/Phường--</option>';
                                wards.forEach(w => {
                                    select.innerHTML += `<option value="${w.ward_code}">${w.name}</option>`;
                                });
                            }

                            document.getElementById("province").addEventListener("change", (e) => {
                                loadWards(e.target.value);
                            });

                            loadProvinces();
                        </script>

                        <div>
                            <div class="mb-2 flex items-center gap-2">
                                <label for="address" class="block text-sm font-medium text-gray-900">Số nhà, tên đường*</label>
                            </div>
                            <input type="text" name="address" id="address" class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500" placeholder="số 5, Phạm Hùng, ..." required />
                        </div>

                        <div class="sm:col-span-2">
                            <button type="submit" class="flex w-full items-center justify-center gap-2 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-sm font-medium text-gray-900 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:outline-none focus:ring-4 focus:ring-gray-100">
                                <svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7 7V5" />
                                </svg>
                                Add new address
                            </button>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-gray-900">Thanh toán</h3>

                    <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                        <div class="rounded-lg border border-gray-200 bg-gray-50 p-4 ps-4">
                            <div class="flex items-start">
                                <div class="flex h-5 items-center">
                                    <input name="paymentType" value="CREDIT_CARD" id="credit-card" type="radio" class="h-4 w-4 border-gray-300 bg-white text-primary-600 focus:ring-2 focus:ring-primary-600" checked />
                                </div>
                                <div class="ms-4 text-sm">
                                    <label for="credit-card" class="font-medium leading-none text-gray-900">Thanh toán thẻ credit</label>
                                    <p id="credit-card-text" class="mt-1 text-xs font-normal text-gray-500">Thanh toán thẻ</p>
                                </div>
                            </div>
                        </div>

                        <div class="rounded-lg border border-gray-200 bg-gray-50 p-4 ps-4">
                            <div class="flex items-start">
                                <div class="flex h-5 items-center">
                                    <input name="paymentType" value="DEBIT_CARD" id="debit-card" type="radio" class="h-4 w-4 border-gray-300 bg-white text-primary-600 focus:ring-2 focus:ring-primary-600" />
                                </div>
                                <div class="ms-4 text-sm">
                                    <label for="debit-card" class="font-medium leading-none text-gray-900">Thanh toán thẻ debit</label>
                                    <p id="debit-card-text" class="mt-1 text-xs font-normal text-gray-500">Thanh toán thẻ</p>
                                </div>
                            </div>
                        </div>

                        <div class="rounded-lg border border-gray-200 bg-gray-50 p-4 ps-4">
                            <div class="flex items-start">
                                <div class="flex h-5 items-center">
                                    <input name="paymentType" value="CASH_ON_DELIVERY" id="pay-on-delivery" type="radio" class="h-4 w-4 border-gray-300 bg-white text-primary-600 focus:ring-2 focus:ring-primary-600" />
                                </div>
                                <div class="ms-4 text-sm">
                                    <label for="pay-on-delivery" class="font-medium leading-none text-gray-900">COD</label>
                                    <p id="pay-on-delivery-text" class="mt-1 text-xs font-normal text-gray-500">Thanh toán khi nhận hàng</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 w-full space-y-6 sm:mt-8 lg:mt-0 lg:max-w-xs xl:max-w-md">
                <div class="flow-root">
                    <div class="-my-3 divide-y divide-gray-200">
                        <dl class="flex items-center justify-between gap-4 py-3">
                            <dt class="text-base font-normal text-gray-500">Tạm tính</dt>
                            <dd class="text-base font-medium text-gray-900" th:text="${#numbers.formatDecimal(originalPrice, 1, 'COMMA', 1, 'POINT')}">$8,094.00</dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4 py-3">
                            <dt class="text-base font-normal text-gray-500">Giảm giá</dt>
                            <dd class="text-base font-medium text-green-500" th:text="${#numbers.formatDecimal(savings, 1, 'COMMA', 1, 'POINT')}">0</dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4 py-3">
                            <dt class="text-base font-normal text-gray-500">Thuế 8%</dt>
                            <dd class="text-base font-medium text-gray-900" th:text="${#numbers.formatDecimal(tax, 1, 'COMMA', 1, 'POINT')}">$99</dd>
                        </dl>

                        <dl class="flex items-center justify-between gap-4 py-3">
                            <dt class="text-base font-bold text-gray-900">Thành tiền</dt>
                            <dd class="text-base font-bold text-gray-900" th:text="${#numbers.formatDecimal(total, 1, 'COMMA', 1, 'POINT')}">$8,392.00</dd>
                        </dl>
                    </div>
                </div>

                <div class="space-y-3">
                    <button type="submit"
                            class="flex w-full items-center justify-center rounded-lg
                             border border-blue-700 bg-blue-700 px-5 py-2.5 text-sm
                             font-medium text-white hover:bg-blue-800
                             focus:outline-none focus:ring-4 focus:ring-blue-300">
                        Đặt hàng
                    </button>
                </div>
            </div>
        </div>
    </form>
</section>



<script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
    // Lấy param từ URL
    const urlParams = new URLSearchParams(window.location.search);
    const result = urlParams.get('result');

    if (result === "success") {
        toastr.success("Đặt hàng thành công!");
    } else if (result === "fail") {
        toastr.error("Đặt hàng thất bại, vui lòng thử lại sau!");
    }
</script>
<script>
    async function loadProvinces() {
        const res = await fetch("http://localhost:8080/api/address/provinces");
        const provinces = await res.json();
        const select = document.getElementById("province");
        select.innerHTML = '<option value="">--Chọn Tỉnh/Thành phố--</option>';
        provinces.forEach(p => {
            select.innerHTML += `<option value="${p.province_code}">${p.name}</option>`;
        });
    }

    async function loadWards(provinceCode) {
        if (!provinceCode) {
            document.getElementById("ward").innerHTML = '<option value="">--Chọn Xã/Phường--</option>';
            return;
        }
        const res = await fetch(`http://localhost:8080/api/address/wards/${provinceCode}`);
        const wards = await res.json();
        const select = document.getElementById("ward");
        select.innerHTML = '<option value="">--Chọn Xã/Phường--</option>';
        wards.forEach(w => {
            select.innerHTML += `<option value="${w.ward_code}">${w.name}</option>`;
        });
    }

    document.getElementById("province").addEventListener("change", (e) => {
        loadWards(e.target.value);
    });

    loadProvinces();
</script>
</body>
</html>